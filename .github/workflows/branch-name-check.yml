name: Validate Branch Name

on:
  push:
    branches:
      - "**"

jobs:
  check-branch:
    runs-on: ubuntu-latest
    steps:
      - name: Get branch name
        id: branch
        run: echo "branch_name=${GITHUB_REF#refs/heads/}" >> $GITHUB_OUTPUT

      - name: Enforce branch naming convention
        run: |
          BRANCH="${{ steps.branch.outputs.branch_name }}"

          echo "Branch: $BRANCH"

          # Allowed base branches
          if echo "$BRANCH" | grep -Eq '^(main|master|dev(elop)?|staging|hotfix|release)$'; then
            echo ":white_check_mark: Allowed base branch: $BRANCH"
            exit 0
          fi

          # Enforce ClickUp-style ID in feature branches (ticket ID optional)
          # e.g., feature/ABC-123-add-scan-endpoint or feature/waitlist-benefits-section
          if echo "$BRANCH" | grep -Eq '^(feature|fix|chore|hotfix|bugfix)/([A-Za-z]+-[0-9]+(-[a-z0-9-]*)?|[a-z0-9-]+)$'; then
            echo ":white_check_mark: Valid feature branch: $BRANCH"
            exit 0
          fi

          echo ":x: Invalid branch name: $BRANCH"
          echo "Branch name must match one of the following:"
          echo "  - main, master, dev, develop, staging, hotfix, release"
          echo "  - feature/<TICKET-ID>-slug (e.g., feature/ABC-123-add-scan-endpoint)"
          echo "  - fix/<TICKET-ID>-slug"
          echo "  - chore/<TICKET-ID>-slug"
          exit 1
